// -*- coding: utf-8 -*-
:encoding: UTF-8


Requirements for Safir SDK Core
===============================

== Background and Introduction

This section aims to provide an introduction into some of the concepts of Safir SDK Core, and to provide a frame of reference for the rest of the document.

=== System vs System of Systems

A _System_ in Safir SDK Core terms is one or more computers connected by the distribution mechanism of Safir SDK Core, the _Dob_ (Distributed Objects). These computers are able to communicate using the Dob. The Dob has certain expectations about the network environment and topology, for example it expects bandwidth to be high. The Dob does not support Split/Join (se below).

A _System of Systems_ in Safir SDK Core terms is for example a system where multiple vehicles each have a Safir SDK Core system that all communicate with each other over radio, and is resilient to very low bandwidth and communication failures, e.g. due to a silent zone.

Safir SDK Core does not provide a mechanism to synchronize between systems, it is only meant for communication within a system. However, it provides some of the building blocks needed to build an inter-system synchronization mechanism.

==== Split/Join

_Split_/_Join_ is a mechanism whereby one or several computers in a system are disconnected from the rest, forming a separate system. At a later time they are reconnected, and _the information sets in the two systems are merged automatically_ to produce one system with a coherent and synchronized information set.

The distribution mechanism in Safir SDK Core is not expected to provide Split/Join functionality. However, the distribution mechanism shall provide the fundamental tools needed to add Split/Join functionality when Safir SDK Core is used to build Systems of Systems.

=== Typical systems
This section aims to define some typical systems where Safir SDK Core can be used for inter-process and inter-computer communication. It is meant to give a framework in which to view the requirements that follow in later sections.

These typical systems are only examples, and more kinds of systems and mixtures between these types are also possible.

==== Single computer system
All business logic applications and gui applications run on the same computer and use Safir SDK Core for inter-process communication. There are no requirements for redundancy.

Network topology:: N/A

==== Client/Server system
All business logic applications run on a server, and there are some or many clients that may or may not all be connected at the same time. All the gui applications typically run on the clients.

Clients send no or very little data between each other, the majority of data is sent to and from the server. Clients may loose contact with the server and be allowed to reconnect automatically.

Network topology:: The clients may be situated on the same LAN as the server, but clients may also be on a WAN or on the other side of VPN tunnels. Different clients may have different connectivity to the server, and clients may not be able to send or receive network packets from all other clients.

==== Vehicle mounted Client/Server system

Same configuration as ``Client/Server system'' above, but with two vital differences:

1. One or more clients may intermittently have very bad connectivity, e.g. due to a slip ring.
2. The network may fail intermittently due to power failures.

==== Client/Server system with redundancy

As ``Client/Server system'' above, but instead of one server there may be two or more servers with redundancy. This means that when a server fails another server will take over its responsibilities with no or very little delay. The redundant server may provide identical or degraded service to the clients.

A failed server will not be allowed to reconnect to the system until the software on the server is in a state where it will not contaminate the system with out of date or incorrect data.

Network topology:: The servers are expected to have good connectivity between them, even if bandwidth may be low and latency may be high. But network failures between the servers are expected to be few. The servers may be located close to each other on the same LAN or far from each other on a WAN or a VPN.
+
If the connectivity between the servers is bad there will be many redundancy failovers which will cause a lot of network traffic and server reboots.

==== Complex RT/IS System

This type of system contains multiple servers with different responsibilities, and all or most of the servers have redundancy. There are many clients, some of which have good connectivity and some that have bad connectivity.

This type of system has a continuous high load of data, the transmission of which requires soft real-time performance. Some of the data is of a transient kind, e.g. data that is updated every second.

Other data in the system has no RT requirements, but may periodically generate a lot of traffic, e.g. database searches.

As described above in ``Client/Server system with redundancy'' the connectivity between the redundant servers is expected to be good.

One or more of the clients can be placed at a remote location, connected via a WAN or a VPN link.

== Requirements
TODO

=== Distribution
TODO

==== Entities
An entity is a class of which there can be objects (known as instances) that are stored in the Dob and has one (and only one) owner. Only the owner is allowed to modify the object. Any application can subscribe for a entity instances, which means that it will receive updates whenever the instances are changed. Applications can also send requests to the entity owner asking it to change something in the object.

Entity updates are guaranteed to reach all subscribers, with one important caveat; subscribers are not guaranteed to see all intermediate states of an entity.

req_1::
    Safir SDK Core shall keep a local object cache with entity instances on each node.

req_2::
    Safir SDK Core shall keep all local object caches synchronized.

req_3::
    Safir SDK Core shall provide a mechanism for applications to register handlers for entity classes.

req_4::
    Safir SDK Core shall provide a mechanism for applications that has a registered handler to create entity instances of the class.

req_5::
    Safir SDK Core shall ensure that an entity instance has one, and only one, owner.

req_6:: 
    Safir SDK Core shall provide a mechanism for entity owners to update entities.

req_7:: 
    Safir SDK Core shall provide a mechanism for entity owners to delete entities.

req_8::
    Safir SDK Core shall provide a mechanism for applications to send requests to handlers to create entities.

req_9::
    Safir SDK Core shall provide a mechanism for applications to send update requests for existing entities. The update requests shall be delivered to the entity owner.

req_10::
    Safir SDK Core shall provide a mechanism for applications to send delete requests for existing entities. The delete requests shall be delivered to the entity owner.

req_3::
    Safir SDK Core shall provide a mechanism for entity handlers/owners to send responses to received requests.

req_11::
    Safir SDK Core shall provide a mechanism for applications to subscribe to entity instance creations.

req_12::
    Safir SDK Core shall provide a mechanism for applications to subscribe to entity instance updates.

req_13::
    Safir SDK Core shall provide a mechanism for applications to subscribe to entity instance deletes.

req_14::
    Safir SDK Core shall provide a mechanism for applications to read entity instance states.

==== Services
A Service has one or more handlers (known as a Service Handler) to which any application (known as a Requestor) can send service requests. For each service request that is sent, a response is received. The response is sent by the Service Handler, and indicates the result of the operation.

req_1::
    Safir SDK Core shall provide a mechanism for applications to register handlers for service classes.

req_2::
    Safir SDK Core shall provide a mechanism for applications to send requests to service handlers.

req_3::
    Safir SDK Core shall provide a mechanism for service handlers to send responses to received requests.

==== Messages
AWI: Fortsätt här!
Messages are data that any application can subscribe to and any application can send. Messages do not have owners in any useful sense. When an application sends a message, the Dob forwards it to all subscribers of that message.

No record is kept of messages, i.e. they are not stored in the Dob in any way. So once the message has been sent there is no way of getting hold of it again.

Messages do not have guaranteed delivery. If some application cannot keep up with the rate of messages it will miss messages. If you need guaranteed delivery, messages are not what you are looking for.


==== Requests/Responses
The following requirements applies to entity create requests, entity update requests, entity delete requests, service requests and their corresponding responses.

req_1::
    If a request can not be delivered or if the receiver of the request does not send a response within a configurable amount of time, Safir SDK Core shall generate a timeout response to the requestor.

==== Addressing  
TODO

=== Persistence
Persistency services are provided to allow applications to store data persistently in order to survive a shutdown of the system or an application.

req_1:: It shall be possible to configure entity types to be persistent.
req_2:: Types marked as persistent shall be automatically persisted.
req_3:: Persistent objects shall be automatically retrieved and passed to the the correct handler when it is started.

=== Types and parameters
Safir SDK Core shall provide a typesystem that can be used between nodes and between applications written in various programming languages.

req_1:: Safir SDK Core shall provide basic types like integers and floating values.
req_2:: Safir SDK Core shall permit custom specific types to be created and distributed by the Dob.

req_3:: Parameters shall be possible to define and store separate from the application. 
req_4:: A parameter shall consist of a name and a value. The value can be of a simple type, which is either an integer, a float or a string or an object composed by simple types and/or objects. 
req_5:: An application shall be able to reference and read the value of a parameter. 
req_6:: It shall be possible to configure a parameter value.

=== OS, Platform and Compiler support
req_1:: Safir SDK Core shall support the latest Ubunutu LTS 32 and 64 bit versions.
req_2:: Safir SDK Core shall support the Windows 7 and Windows 8 64 bit versions.
req_3:: Safir SDK Core shall support Visual Studio 2010 and later.
req_4:: Safir SDK Core shall support the gcc version shipped with latstest Ubuntu LTS.

=== Error and event logging
Logging functionality is provided to report errors and information detected by software. All timestamps shall be fetched from the local computer clock.

req_1:: Safir SDK Core shall provide a mechanism for logging erors and information.
req_2:: Logs shall contain timestamp based on the computer clock, category and a log text.

=== Languages
It shall be possible to use Safir SDK Core from different programming languages. Applications written i different languages shall be able to communicate seamlessly.

req_1:: Safir SDK Core shall provide programming interfaces in C++.
req_2:: Safir SDK Core shall provide programming interfaces in Java.
req_3:: Safir SDK Core shall provide programming interfaces in .Net.
req_4:: Safir SDK Core shall provide programming interfaces in Ada.

=== System control and redundancy
Node supervision along with redundancy is provided to detect and act on unexpected application or node losses. The system control mechanism starts and stops the entire system including the Dob and will also keep an unambiguous view of the system, i.e which nodes are part of the system and where individual applications are executiung.

req_1:: It shall be possible to supervise the existence of a node .
req_2:: It shall be possible to automatically restart a node after an uncontrolled stop. 
req_3:: It shall be possible to define a fallback system configuration as an addition to the basic system configuration. The fallback system configuration shall be automatically switched to when the basic configuration fails.  
req_4:: Safir SDK Core shall provide a start mechanism that starts the system.
req_5:: Safir SDK Core shall provide a stop mechanism that stops the system.
req_6:: The start/stop mechanism shall be configurable to start external applications that is not part of Safir SDK Core.
req_7:: The start/stop mechanism shall be able start and stop applications on any node in the system.
req_8:: The control mechanism provide an unambiguous view of wich nodes are part of the system.

=== Context
Information shall be posible to separate into different contexts within the same system. For example real information should never be mixed up with replayed or simulated information.

req_1:: Safir SDK Core shall support separation of information belonging to different contexts.

